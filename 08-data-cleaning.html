<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.2.232">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Introduction to Statistical Computing - 8&nbsp; Data Summaries and Data Cleaning</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="site_libs/quarto-nav/headroom.min.js"></script>
  <script src="site_libs/clipboard/clipboard.min.js"></script>
  <meta name="quarto:offset" content="./">
  <script src="site_libs/quarto-search/autocomplete.umd.js"></script>
  <script src="site_libs/quarto-search/fuse.min.js"></script>
  <script src="site_libs/quarto-search/quarto-search.js"></script>
  <link href="./09-functions.html" rel="next">
  <link href="./07-data-transformations.html" rel="prev">
  <script src="site_libs/quarto-html/quarto.js"></script>
  <script src="site_libs/quarto-html/popper.min.js"></script>
  <script src="site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="site_libs/quarto-html/anchor.min.js"></script>
  <link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <script src="site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <script id="quarto-search-options" type="application/json">{
    "location": "sidebar",
    "copy-button": false,
    "collapse-after": 2,
    "panel-placement": "start",
    "type": "textbox",
    "limit": 20
  }</script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="quarto-search-results"></div>
<header id="quarto-header" class="headroom fixed-top">
<nav class="quarto-secondary-nav py-2 d-lg-none d-md-block " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <div class="container-fluid d-flex justify-content-between">
    <h1 class="quarto-secondary-nav-title mb-0 fs-3 d-inline"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data Summaries and Data Cleaning</span></h1>
    <button type="button" class="quarto-btn-toggle btn d-lg-none py-0 px-1 d-inline-block border-0 ">
      <i class="bi bi-chevron-right"></i>
    </button>
  </div>
</nav>
</header>
 <!-- /navbar/sidebar -->
<div class="container-fluid quarto-container d-flex flex-column page-layout-article" id="quarto-content">
<div class="row flex-fill">
  <div id="quarto-sidebar" class="col col-12 col-lg-3 d-lg-flex px-0 pt-0 sidebar collapse sidebar-navigation">
    <nav class="ms-lg-auto floating overflow-auto">
  <div class="px-3 pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Statistical Computing</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/srvanderplas/Stat151" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
            <i class="bi bi-bi-linkedin pe-1"></i>
          LinkedIn
          </a>
        </li>
    </ul>
</div>
    </div>
  </div>
    <div class="px-3 mt-2 flex-shrink-0 align-items-center">
      <div class="sidebar-search">
      <div id="quarto-search" class="mb-0 " title="Search">
</div>
      </div>
    </div>
  <div class="sidebar-menu-container"> 
  <ul class="list-unstyled mt-1 px-3">
      <li class="sidebar-item">
  <a href="./index.html" class="">Preface</a>
</li>
      <li class="sidebar-item">
  <a href="./01-getting-started.html" class=""><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started</span></a>
</li>
      <li class="sidebar-item">
  <a href="./02-markdown.html" class=""><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Scripts and Notebooks</span></a>
</li>
      <li class="sidebar-item">
  <a href="./03-finding-your-way.html" class=""><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Finding your way in R and Python</span></a>
</li>
      <li class="sidebar-item">
  <a href="./04-data-types.html" class=""><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Basic Data Types</span></a>
</li>
      <li class="sidebar-item">
  <a href="./05-vectors.html" class=""><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Vectors, Matrices, Arrays, and Control Structures</span></a>
</li>
      <li class="sidebar-item">
  <a href="./06-data-structures.html" class=""><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Structures</span></a>
</li>
      <li class="sidebar-item">
  <a href="./07-data-transformations.html" class=""><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Transformations</span></a>
</li>
      <li class="sidebar-item">
  <a href="./08-data-cleaning.html" class="active"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data Summaries and Data Cleaning</span></a>
</li>
      <li class="sidebar-item">
  <a href="./09-functions.html" class=""><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Functions</span></a>
</li>
      <li class="sidebar-item">
  <a href="./git-github.html" class=""><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">git-github.html</span></a>
</li>
      <li class="sidebar-item">
  <a href="./references.html" class="">References</a>
</li>
  </ul>
  </div>
</nav>
  </div>
  <div id="quarto-toc-sidebar" class=" pt-0 col col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-toc order-last"><nav id="TOC" role="doc-toc">
<h2 id="toc-title">On this page</h2>
<ul>
<li><a href="#merging-tables" class="nav-link active" data-scroll-target="#merging-tables"> <span class="header-section-number">8.1</span> Merging Tables</a>
<ul class="collapse">
<li><a href="#try-it-out" class="nav-link" data-scroll-target="#try-it-out">Try it out</a></li>
</ul></li>
<li><a href="#data-summaries" class="nav-link" data-scroll-target="#data-summaries"> <span class="header-section-number">8.2</span> Data Summaries</a></li>
<li><a href="#working-with-text" class="nav-link" data-scroll-target="#working-with-text"> <span class="header-section-number">8.3</span> Working with Text</a>
<ul class="collapse">
<li><a href="#basic-string-operations" class="nav-link" data-scroll-target="#basic-string-operations"> <span class="header-section-number">8.3.1</span> Basic String Operations</a></li>
<li><a href="#joining-and-splitting-variables" class="nav-link" data-scroll-target="#joining-and-splitting-variables"> <span class="header-section-number">8.3.2</span> Joining and Splitting Variables</a></li>
<li><a href="#additional-string-manipulation-information" class="nav-link" data-scroll-target="#additional-string-manipulation-information">Additional String Manipulation Information</a></li>
</ul></li>
</ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/srvanderplas/Stat151/edit/main/08-data-cleaning.qmd" class="toc-action">Edit this page</a></p></div></div></nav></div>
  <div class="col mx-auto col-sm-12 col-md-9 col-lg-7 col-xl-7 px-lg-4 pe-xxl-4 ps-xxl-3">
<main>
<header id="title-block-header">
<h1 class="title d-none d-lg-block display-7"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data Summaries and Data Cleaning</span></h1>
</header>

<p>In this chapter, we’ll talk a bit about different operations you may need to do in order to clean your data up and get it into the form you want.</p>
<section id="merging-tables" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="merging-tables"><span class="header-section-number">8.1</span> Merging Tables</h2>
<p>Sometimes, we have two tables that we want to join together by a certain variable.</p>
<p>We know how to work on one table at a time, creating new variables, editing old variables, and even reformatting the table using wide and long format, but data doesn’t always come organized in one table at a time. Instead, some data may be organized relationally - that is, certain aspects of the data apply to a group of data points, and certain aspects apply to individual data points, and there are relationships between individuals that have to be documented.</p>
<div class="ex">
<details>
<summary>
Example: Primary School Organization
</summary>
<p>Each individual has certain characteristics:</p>
<ul>
<li>full_name</li>
<li>gender</li>
<li>birth date</li>
<li>ID number</li>
</ul>
<p>Each student has specific characteristics:</p>
<ul>
<li>ID number</li>
<li>parent name</li>
<li>parent phone number</li>
<li>medical information</li>
<li>Class ID</li>
</ul>
<p>Teachers may also have additional information:</p>
<ul>
<li>ID number</li>
<li>Class ID</li>
<li>employment start date</li>
<li>education level</li>
<li>compensation level</li>
</ul>
<p>There are also fields like grades, which occur for each student in each class, but multiple times a year.</p>
<ul>
<li>ID number</li>
<li>Student ID</li>
<li>Class ID</li>
<li>year</li>
<li>term number</li>
<li>subject</li>
<li>grade</li>
<li>comment</li>
</ul>
<p>And for teachers, there are employment records on a yearly basis</p>
<ul>
<li>ID number</li>
<li>Employee ID</li>
<li>year</li>
<li>rating</li>
<li>comment</li>
</ul>
<p>But each class also has characteristics that describe the whole class as a unit:</p>
<ul>
<li>location ID</li>
<li>class ID</li>
<li>meeting time</li>
<li>grade level</li>
</ul>
<p>Each location might also have some logistical information attached:</p>
<ul>
<li>location ID</li>
<li>room number</li>
<li>building</li>
<li>number of seats</li>
<li>AV equipment</li>
</ul>
<p><img src="images/PrimarySchoolExample.png" class="img-fluid" alt="Primary School Database Schema"> <!-- <a href="https://dbdiagram.io/embed/5ef387179ea313663b3b048e">Link to diagram of the database</a> --></p>
<p>We could go on, but you can see that this data is hierarchical, but also relational:</p>
<ul>
<li>each class has both a teacher and a set of students</li>
<li>each class is held in a specific location that has certain equipment</li>
</ul>
<p>It would be silly to store this information in a single table (though it probably can be done) because all of the teacher information would be duplicated for each student in each class; all of the student’s individual info would be duplicated for each grade. There would be a lot of wasted storage space and the tables would be much more confusing as well.</p>
<p>But, relational data also means we have to put in some work when we have a question that requires information from multiple tables. Suppose we want a list of all of the birthdays in a certain class. We would need to take the following steps:</p>
<ul>
<li>get the Class ID</li>
<li>get any teachers that are assigned that Class ID - specifically, get their ID number</li>
<li>get any students that are assigned that Class ID - specifically, get their ID number</li>
<li>append the results from teachers and students so that there is a list of all individuals in the class</li>
<li>look through the “individual data” table to find any individuals with matching ID numbers, and keep those individuals’ birth days.</li>
</ul>
</details>
</div>
<p>Table joins allow us to combine information stored in different tables, keeping certain information (the stuff we need) while discarding extraneous information.</p>
<p>There are 3 main types of table joins:</p>
<ul>
<li><p><strong>Filtering joins</strong>, which remove rows from a table based on whether or not there is a matching row in another table (but the columns in the original table don’t change)<br>
Ex: finding all teachers or students who have class ClassID</p></li>
<li><p><strong>Set operations</strong>, which treat observations as set elements (e.g.&nbsp;union, intersection, etc.)<br>
Ex: taking the union of all student and teacher IDs to get a list of individual IDs</p></li>
<li><p><strong>Mutating joins</strong>, which add columns from one table to matching rows in another table<br>
Ex: adding birthday to the table of all individuals in a class</p></li>
</ul>
<p><strong>keys</strong> are values that are found in multiple tables that can be used to connect the tables. A key (or set of keys) uniquely identify an observation. A <strong>primary key</strong> identifies an observation in its own table. A <strong>foreign key</strong> identifies an observation in another table.</p>
<p>We’re primarily going to focus on mutating joins, as filtering joins can be accomplished by … filtering … rather than by table joins. Feel free to read through the other types of joins <a href="https://r4ds.had.co.nz/relational-data.html#filtering-joins">here</a></p>
<details>
<summary>
Animating different types of joins
</summary>
<p>Note: all of these animations are stolen from https://github.com/gadenbuie/tidyexplain.</p>
<p>If we start with two tables, x and y,</p>
<p><img src="images/dplyr-original-dfs.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># Must load this library to do these joins</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">c1 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">cx =</span> <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">c1 =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>), <span class="at">cy =</span> <span class="fu">c</span>(<span class="st">"y1"</span>, <span class="st">"y2"</span>, <span class="st">"y4"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd <span class="co"># must load pandas to do joins</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> r.x</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> r.y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can do a filtering <code>inner_join</code> to keep only rows which are in both tables (but we keep all columns)</p>
<p><img src="images/dplyr-inner-join.gif" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(x, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Joining, by = "c1"</code></pre>
</div>
<div class="cell-output-stdout">
<pre><code>  c1 cx cy
1  1 x1 y1
2  2 x2 y2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>pd.merge(x, y) <span class="co"># by default, merge uses inner join</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>   c1  cx  cy
0   1  x1  y1
1   2  x2  y2</code></pre>
</div>
</div>
<p>But what if we want to keep all of the rows in x? We would do a <code>left_join</code></p>
<p><img src="images/dplyr-left-join.gif" class="img-fluid"></p>
<p>If there are multiple matches in the y table, though, we might have to duplicate rows in x. This is still a left join, just a more complicated one.</p>
<p><img src="images/dplyr-left-join-extra.gif" class="img-fluid"> ::: {.cell}</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(x, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Joining, by = "c1"</code></pre>
</div>
<div class="cell-output-stdout">
<pre><code>  c1 cx   cy
1  1 x1   y1
2  2 x2   y2
3  3 x3 &lt;NA&gt;</code></pre>
</div>
<p>:::</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>pd.merge(x, y, how <span class="op">=</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>   c1  cx   cy
0   1  x1   y1
1   2  x2   y2
2   3  x3  NaN</code></pre>
</div>
</div>
<p>If we wanted to keep all of the rows in y, we would do a <code>right_join</code>:</p>
<p><img src="images/dplyr-right-join.gif" class="img-fluid"></p>
<p>(or, we could do a left join with y and x, but… either way is fine).</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">right_join</span>(x, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Joining, by = "c1"</code></pre>
</div>
<div class="cell-output-stdout">
<pre><code>  c1   cx cy
1  1   x1 y1
2  2   x2 y2
3  4 &lt;NA&gt; y4</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>pd.merge(x, y, how <span class="op">=</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>    c1   cx  cy
0  1.0   x1  y1
1  2.0   x2  y2
2  4.0  NaN  y4</code></pre>
</div>
</div>
<p>And finally, if we want to keep all of the rows, we’d do a <code>full_join</code> (referred to as an “outer join” in pandas):</p>
<p><img src="images/dplyr-full-join.gif" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">full_join</span>(x, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Joining, by = "c1"</code></pre>
</div>
<div class="cell-output-stdout">
<pre><code>  c1   cx   cy
1  1   x1   y1
2  2   x2   y2
3  3   x3 &lt;NA&gt;
4  4 &lt;NA&gt;   y4</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>pd.merge(x, y, how <span class="op">=</span> <span class="st">"outer"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>    c1   cx   cy
0  1.0   x1   y1
1  2.0   x2   y2
2  3.0   x3  NaN
3  4.0  NaN   y4</code></pre>
</div>
</div>
<p>You can find other animations corresponding to filtering joins and set operations <a href="https://github.com/gadenbuie/tidyexplain">here</a></p>
</details>
<section id="try-it-out" class="level3 tryitout unnumbered">
<h3 class="tryitout unnumbered anchored" data-anchor-id="try-it-out">Try it out</h3>
<p><a href="https://rebrickable.com/downloads/">Rebrickable.com</a> maintains a database of Lego sets, parts, and other data, available for download. You can download the data yourself, or you can use the tables I’ve downloaded and included: <a href="data/sets.csv">sets</a> and <a href="data/themes.csv">themes</a></p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>sets <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/srvanderplas/Stat151/main/data/sets.csv"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>themes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/srvanderplas/Stat151/main/data/themes.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>sets <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/srvanderplas/Stat151/main/data/sets.csv"</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>themes <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/srvanderplas/Stat151/main/data/themes.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s start out by joining the two datasets together. Note that we’ll need to specify which columns to join by in both R and pandas. In R, we’ll need to use <code>by = c(left_col = right_col)</code> to specify the column names in the left and right data frames. In pandas, we’ll need to use arguments <code>left_on = 'left_col'</code> and <code>right_on = 'right_col'</code>.</p>
<p><strong>First, let’s try a full/outer join.</strong></p>
<details>
<summary>
R solution
</summary>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>lego_fulljoin <span class="ot">&lt;-</span> <span class="fu">full_join</span>(sets, themes, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"theme_id"</span> <span class="ot">=</span> <span class="st">"id"</span>))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lego_fulljoin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  set_num                     name.x year theme_id num_parts       name.y
1   001-1                      Gears 1965        1        43      Technic
2  0011-2          Town Mini-Figures 1979       67        12 Classic Town
3  0011-3 Castle 2 for 1 Bonus Offer 1987      199         0 Lion Knights
4  0012-1         Space Mini-Figures 1979      143        12 Supplemental
5  0013-1         Space Mini-Figures 1979      143        12 Supplemental
6  0014-1         Space Mini-Figures 1979      143        12 Supplemental
  parent_id
1        NA
2        50
3       186
4       126
5       126
6       126</code></pre>
</div>
</div>
</details>
<details>
<summary>
Python solution
</summary>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>lego_fulljoin <span class="op">=</span> pd.merge(sets, themes, left_on <span class="op">=</span> <span class="st">"theme_id"</span>, right_on <span class="op">=</span> <span class="st">"id"</span>, how <span class="op">=</span> <span class="st">"outer"</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>lego_fulljoin.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  set_num                          name_x    year  ...  id   name_y  parent_id
0   001-1                           Gears  1965.0  ...   1  Technic        NaN
1   002-1  4.5V Samsonite Gears Motor Set  1965.0  ...   1  Technic        NaN
2  1030-1  TECHNIC I: Simple Machines Set  1985.0  ...   1  Technic        NaN
3  1038-1              ERBIE the Robo-Car  1985.0  ...   1  Technic        NaN
4  1039-1            Manual Control Set 1  1986.0  ...   1  Technic        NaN

[5 rows x 8 columns]</code></pre>
</div>
</div>
</details>
<p><strong>Sometimes, it’s easier to rename the columns before merging.</strong> Try that approach - if you have the same name for the columns that you intend to join on (and no other common names) then it’s easier to do the join and to understand what is happening. Try it out with the lego sets to see which approach you prefer.</p>
<details>
<summary>
R solution
</summary>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>sets_rn <span class="ot">&lt;-</span> sets <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">set_name =</span> name)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>themes_rn <span class="ot">&lt;-</span> themes <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">theme_name =</span> name, <span class="at">theme_id =</span> id, <span class="at">theme_parent_id =</span> parent_id)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>lego_fulljoin <span class="ot">&lt;-</span> <span class="fu">full_join</span>(sets_rn, themes_rn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Joining, by = "theme_id"</code></pre>
</div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lego_fulljoin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  set_num                   set_name year theme_id num_parts   theme_name
1   001-1                      Gears 1965        1        43      Technic
2  0011-2          Town Mini-Figures 1979       67        12 Classic Town
3  0011-3 Castle 2 for 1 Bonus Offer 1987      199         0 Lion Knights
4  0012-1         Space Mini-Figures 1979      143        12 Supplemental
5  0013-1         Space Mini-Figures 1979      143        12 Supplemental
6  0014-1         Space Mini-Figures 1979      143        12 Supplemental
  theme_parent_id
1              NA
2              50
3             186
4             126
5             126
6             126</code></pre>
</div>
</div>
</details>
<details>
<summary>
Python solution
</summary>
<p>To do this, I consulted <a href="https://stackoverflow.com/questions/11346283/renaming-column-names-in-pandas">stackoverflow</a></p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>sets_rn <span class="op">=</span> sets <span class="co"># copy the dataset</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>sets_rn <span class="op">=</span> sets_rn.rename(columns <span class="op">=</span> {<span class="st">'name'</span>:<span class="st">'set_name'</span>})</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>themes_rn <span class="op">=</span> themes.rename(columns <span class="op">=</span> {<span class="st">'id'</span>: <span class="st">'theme_id'</span>, <span class="st">'parent_id'</span>:<span class="st">'theme_parent_id'</span>, <span class="st">'name'</span> :<span class="st">'theme_name'</span>})</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>lego_fulljoin <span class="op">=</span> pd.merge(sets_rn, themes_rn, how <span class="op">=</span> <span class="st">"outer"</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>lego_fulljoin.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  set_num                        set_name  ...  theme_name  theme_parent_id
0   001-1                           Gears  ...     Technic              NaN
1   002-1  4.5V Samsonite Gears Motor Set  ...     Technic              NaN
2  1030-1  TECHNIC I: Simple Machines Set  ...     Technic              NaN
3  1038-1              ERBIE the Robo-Car  ...     Technic              NaN
4  1039-1            Manual Control Set 1  ...     Technic              NaN

[5 rows x 7 columns]</code></pre>
</div>
</div>
</details>
<p><strong>Which type of join?</strong> In some cases, we might prefer to use a different type of join. If our goal is to add the context of theme information to the set data, we might not care about themes that don’t have corresponding sets in our data. Can you determine what type of join is appropriate here?</p>
<details>
<summary>
R solution
</summary>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>lego_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(sets_rn, themes_rn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Joining, by = "theme_id"</code></pre>
</div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lego_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  set_num                   set_name year theme_id num_parts   theme_name
1   001-1                      Gears 1965        1        43      Technic
2  0011-2          Town Mini-Figures 1979       67        12 Classic Town
3  0011-3 Castle 2 for 1 Bonus Offer 1987      199         0 Lion Knights
4  0012-1         Space Mini-Figures 1979      143        12 Supplemental
5  0013-1         Space Mini-Figures 1979      143        12 Supplemental
6  0014-1         Space Mini-Figures 1979      143        12 Supplemental
  theme_parent_id
1              NA
2              50
3             186
4             126
5             126
6             126</code></pre>
</div>
</div>
</details>
<details>
<summary>
Python solution
</summary>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>lego_data <span class="op">=</span> pd.merge(sets_rn, themes_rn, how <span class="op">=</span> <span class="st">"left"</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>lego_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  set_num                    set_name  ...    theme_name  theme_parent_id
0   001-1                       Gears  ...       Technic              NaN
1  0011-2           Town Mini-Figures  ...  Classic Town             50.0
2  0011-3  Castle 2 for 1 Bonus Offer  ...  Lion Knights            186.0
3  0012-1          Space Mini-Figures  ...  Supplemental            126.0
4  0013-1          Space Mini-Figures  ...  Supplemental            126.0

[5 rows x 7 columns]</code></pre>
</div>
</div>
</details>
<p><strong>Using Your Data</strong> Pick a theme you’re interested in, and plot the number of pieces in the sets of that theme over time.</p>
<details>
<summary>
R solution
</summary>
<p>I want to look at Pirates sets. We can see that there are 3 generations of main “Pirates” theme sets, but there is a parent theme that contains all of them. So let’s filter the full dataset on that parent id.</p>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>themes <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Pirates"</span>, name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>   id                            name parent_id
1 147                         Pirates        NA
2 148                       Pirates I       147
3 153                      Pirates II       147
4 154                     Pirates III       147
5 215                         Pirates       207
6 263        Pirates of the Caribbean        NA
7 638 Jake and the Never Land Pirates       504
8 651                         Pirates       504</code></pre>
</div>
<div class="sourceCode" id="cb47"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>lego_data <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(theme_parent_id <span class="sc">==</span> <span class="dv">147</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> num_parts)) <span class="sc">+</span> <span class="fu">geom_jitter</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-data-cleaning_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</details>
<details>
<summary>
Python solution
</summary>
<p>In this case, let’s look at any sets that have a theme name containing “Jurassic” (Park, World, etc.)</p>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>dinos <span class="op">=</span> lego_data.loc[lego_data[<span class="st">"theme_name"</span>].<span class="bu">str</span>.contains(<span class="st">"Jurassic"</span>)]</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>ggplot(dinos, aes(x <span class="op">=</span> <span class="st">"year"</span>, y <span class="op">=</span> <span class="st">"num_parts"</span>)) <span class="op">+</span> geom_jitter()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>&lt;ggplot: (8774280686144)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="08-data-cleaning_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="614"></p>
</div>
</div>
</details>
</section>
</section>
<section id="data-summaries" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="data-summaries"><span class="header-section-number">8.2</span> Data Summaries</h2>
<p>We’ve talked before about using for loops to create summaries of your data, as in <a href="06-data-structures.html#summaries-part-2">this example</a>.</p>
<p>In may cases, however, it is easier to use a slightly different mechanism to work with groups of data. What do I mean by groups of data? When we used loops, the variable we “group by” is the variable controlling the loop.</p>
<details>
<summary>
Summarizing data with Lego
</summary>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/lego-ungrouped-data-frame.png" class="img-fluid figure-img"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">A lego “data frame” with two columns: green 1x2s and purple/pink 1x4s.</figcaption><p></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/lego-grouped-data-frame.png" class="img-fluid figure-img"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">We can “group” the data frame by the different shades of 1x2 lego pieces</figcaption><p></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/lego-grouped-data-frame-summary.png" class="img-fluid figure-img"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">We can then compute a summary variable for the group, picking out e.g.&nbsp;the most “intense” shade in the purple/pink column.</figcaption><p></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/lego-grouped-summary.png" class="img-fluid figure-img"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">Looking only at the summary, we could then ungroup our data and return to a regular data frame… only this time, we have a summary, with one row for each different value of the green column</figcaption><p></p>
</figure>
</div>
</details>
<p>In R/tidyverse syntax, we would use the <code>group_by</code> function to group a dataframe by a variable, and then we would use <code>mutate</code> or <code>summarize</code> to create our new column(s). <code>mutate</code> would be used if we want to have the same number of rows in our output as we had in the input, while <code>summarize</code> would create one row per group.</p>
<p>In python syntax, we use <code>groupby</code> to group the DataFrame by a variable, and then we use <code>.agg</code> to aggregate. The function <code>pd.NamedAgg(column, function)</code> allows us to explicitly state that we want to use function <code>function</code> on column <code>column</code>, and assign that result to a new variable.</p>
<div class="ex">
<p>Suppose we want to summarize the lego set data by year, computing the number of sets and the mean number of pieces per set. We’ll take the data set we generate and plot the number of pieces, with point size scaled to show the number of sets released that year.</p>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>sets <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">mean_pieces =</span> <span class="fu">mean</span>(num_parts)) <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> mean_pieces, <span class="at">size =</span> n)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-data-cleaning_files/figure-html/unnamed-chunk-21-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="op">=</span> sets.groupby(<span class="st">"year"</span>, as_index <span class="op">=</span> <span class="va">False</span>).agg(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  mean_pieces <span class="op">=</span> pd.NamedAgg(<span class="st">'num_parts'</span>, <span class="st">'mean'</span>),</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  n <span class="op">=</span> pd.NamedAgg(<span class="st">'num_parts'</span>, <span class="st">'count'</span>))</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>ggplot(tmp, aes(x <span class="op">=</span> <span class="st">"year"</span>, y <span class="op">=</span> <span class="st">"mean_pieces"</span>, size <span class="op">=</span> <span class="st">"n"</span>)) <span class="op">+</span> geom_point()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>&lt;ggplot: (8774271152776)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="08-data-cleaning_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="614"></p>
</div>
</div>
</div>
</section>
<section id="working-with-text" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="working-with-text"><span class="header-section-number">8.3</span> Working with Text</h2>
<p>Nearly always, when multiple variables are stored in a single column, they are stored as character variables. There are many different “levels” of working with strings in programming, from simple find-and-replaced of fixed (constant) strings to regular expressions, which are extremely powerful (and extremely complicated).</p>
<blockquote class="blockquote">
<p>Some people, when confronted with a problem, think “I know, I’ll use regular expressions.” Now they have two problems. - Jamie Zawinski</p>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://imgs.xkcd.com/comics/perl_problems.png" class="img-fluid figure-img"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">Alternately, the xkcd version of the above quote</figcaption><p></p>
</figure>
</div>
<section id="basic-string-operations" class="level3" data-number="8.3.1">
<h3 data-number="8.3.1" class="anchored" data-anchor-id="basic-string-operations"><span class="header-section-number">8.3.1</span> Basic String Operations</h3>
<p>The tidyverse package to deal with strings is <a href="https://stringr.tidyverse.org/"><code>stringr</code></a>. The functions in stringr take the form of <code>str_XXX</code> where XXX is a verb. So <code>str_split()</code>, <code>str_replace()</code>, <code>str_remove()</code>, <code>str_to_lower()</code> all should make some sense.</p>
<p>The corresponding python library is <code>re</code>, short for regular expression. Pandas also includes some functionality from this package in (partially) vectorized form.</p>
<div class="ex">
<p>For this example, we’ll use a subset of the US Department of Education College Scorecard data. <a href="https://collegescorecard.ed.gov/data/documentation/">Documentation</a>, <a href="https://collegescorecard.ed.gov/data/">Data</a>. I’ve selected a few columns from the institution-level data available on the College Scorecard site.</p>
<details>
<summary>
Let’s take a look (Read in the data)
</summary>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>college <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/srvanderplas/Stat151/main/data/College_Data_Abbrev.csv"</span>, <span class="at">guess_max =</span> <span class="dv">5000</span>, <span class="at">na =</span> <span class="st">'.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>`curl` package not installed, falling back to using `url()`
Rows: 6806 Columns: 17
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (14): INSTNM, CITY, STABBR, ZIP, ACCREDAGENCY, INSTURL, PREDDEG, MAIN, H...
dbl  (3): UNITID, NUMBRANCH, ST_FIPS

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode" id="cb55"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(college)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>spec_tbl_df [6,806 × 17] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ UNITID      : num [1:6806] 100654 100663 100690 100706 100724 ...
 $ INSTNM      : chr [1:6806] "Alabama A &amp; M University" "University of Alabama at Birmingham" "Amridge University" "University of Alabama in Huntsville" ...
 $ CITY        : chr [1:6806] "Normal" "Birmingham" "Montgomery" "Huntsville" ...
 $ STABBR      : chr [1:6806] "AL" "AL" "AL" "AL" ...
 $ ZIP         : chr [1:6806] "35762" "35294-0110" "36117-3553" "35899" ...
 $ ACCREDAGENCY: chr [1:6806] "Southern Association of Colleges and Schools Commission on Colleges" "Southern Association of Colleges and Schools Commission on Colleges" "Southern Association of Colleges and Schools Commission on Colleges" "Southern Association of Colleges and Schools Commission on Colleges" ...
 $ INSTURL     : chr [1:6806] "www.aamu.edu/" "https://www.uab.edu" "www.amridgeuniversity.edu" "www.uah.edu" ...
 $ PREDDEG     : chr [1:6806] "Predominantly bachelor's-degree granting" "Predominantly bachelor's-degree granting" "Predominantly bachelor's-degree granting" "Predominantly bachelor's-degree granting" ...
 $ MAIN        : chr [1:6806] "main campus" "main campus" "main campus" "main campus" ...
 $ NUMBRANCH   : num [1:6806] 1 1 1 1 1 1 1 1 1 1 ...
 $ HIGHDEG     : chr [1:6806] "Graduate" "Graduate" "Graduate" "Graduate" ...
 $ CONTROL     : chr [1:6806] "Public" "Public" "Private Non Profit" "Public" ...
 $ ST_FIPS     : num [1:6806] 1 1 1 1 1 1 1 1 1 1 ...
 $ LOCALE      : chr [1:6806] "12" "12" "12" "12" ...
 $ LATITUDE    : chr [1:6806] "34.783368" "33.505697" "32.362609" "34.724557" ...
 $ LONGITUDE   : chr [1:6806] "-86.568502" "-86.799345" "-86.17401" "-86.640449" ...
 $ State       : chr [1:6806] "Alabama" "Alabama" "Alabama" "Alabama" ...
 - attr(*, "spec")=
  .. cols(
  ..   UNITID = col_double(),
  ..   INSTNM = col_character(),
  ..   CITY = col_character(),
  ..   STABBR = col_character(),
  ..   ZIP = col_character(),
  ..   ACCREDAGENCY = col_character(),
  ..   INSTURL = col_character(),
  ..   PREDDEG = col_character(),
  ..   MAIN = col_character(),
  ..   NUMBRANCH = col_double(),
  ..   HIGHDEG = col_character(),
  ..   CONTROL = col_character(),
  ..   ST_FIPS = col_double(),
  ..   LOCALE = col_character(),
  ..   LATITUDE = col_character(),
  ..   LONGITUDE = col_character(),
  ..   State = col_character()
  .. )
 - attr(*, "problems")=&lt;externalptr&gt; </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>college <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/srvanderplas/Stat151/main/data/College_Data_Abbrev.csv"</span>, na_values <span class="op">=</span> <span class="st">'.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<details>
<summary>
What proportion of the schools operating in each state have the state’s name in the school name?
</summary>
<p>We’ll use <code>str_detect()</code> to look for the state name in the college name.</p>
<div class="cell">
<div class="sourceCode" id="cb58"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr) <span class="co"># string processing</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Outside the pipe</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(college<span class="sc">$</span>INSTNM, <span class="at">pattern =</span> college<span class="sc">$</span>State)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code> [1]  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE</code></pre>
</div>
<div class="sourceCode" id="cb60"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the pipe and mutate:</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>college <span class="ot">&lt;-</span> college <span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">uses_st_name =</span> <span class="fu">str_detect</span>(INSTNM, State))</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># graphs and charts</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="co"># By state - percentage of institution names</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>college <span class="sc">%&gt;%</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(State) <span class="sc">%&gt;%</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">pct_uses_st_name =</span> <span class="fu">mean</span>(uses_st_name), <span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="co"># only states/territories with at least 5 schools</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reorder state factor level by percentage that uses state name</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">State =</span> <span class="fu">reorder</span>(State, <span class="sc">-</span>pct_uses_st_name)) <span class="sc">%&gt;%</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> ., <span class="fu">aes</span>(<span class="at">x =</span> State, <span class="at">y =</span> pct_uses_st_name)) <span class="sc">+</span> </span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">1</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Total Schools:"</span>, n)), <span class="at">hjust =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-data-cleaning_files/figure-html/string-ops-1.png" class="img-fluid" width="4"></p>
</div>
</div>
<p>This example turned out to be way more complicated in Python than I was anticipating, mostly because unlike R, python string operations aren’t vectorized over both the string and the pattern you’re searching for. So this example uses a few tricks (like apply + lambda functions) that we haven’t talked about yet.</p>
<div class="cell">
<div class="sourceCode" id="cb61"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re <span class="co"># regular expressions</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This doesn't work because str.contains doesn't take a vector of patterns</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co"># college["INSTNM"].str.contains(college["State"])[1:10]</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co"># This is a function that we create</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="co"># We'll cover functions in the next chapter</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="co"># but for now, I've used this so that the code is a little more readable...</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> str_detect(x, y):</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure x and y aren't null/NaN</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  null_vals <span class="op">=</span> pd.isna(x) <span class="kw">or</span> pd.isna(y)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If they aren't null, then search x for pattern y and return the result</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="kw">not</span> null_vals:</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">bool</span>(re.search(y, x))</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If there are null/na values, return False</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a><span class="co"># We then create a new variable by using our function on each row individually</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>college <span class="op">=</span> college.assign(uses_st_name <span class="op">=</span> college.<span class="bu">apply</span>(<span class="kw">lambda</span> row: str_detect(row.INSTNM, row.State), axis <span class="op">=</span> <span class="dv">1</span>))</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Then we aggregate</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>college_names <span class="op">=</span> college.groupby(<span class="st">"State"</span>, as_index <span class="op">=</span> <span class="va">False</span>).agg(</span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>  pct_uses_st_name <span class="op">=</span> pd.NamedAgg(<span class="st">'uses_st_name'</span>, <span class="st">'mean'</span>),</span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>  n <span class="op">=</span> pd.NamedAgg(<span class="st">'uses_st_name'</span>, <span class="st">'count'</span>)</span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Sorting by percent using state name</span></span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>college_names <span class="op">=</span> college_names.loc[college_names.n <span class="op">&gt;</span> <span class="dv">5</span>].<span class="op">\</span></span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a>  sort_values(<span class="st">'pct_uses_st_name'</span>, axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a label variable</span></span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a>college_names[<span class="st">'label'</span>] <span class="op">=</span> <span class="st">"Total Schools: "</span> <span class="op">+</span> college_names[<span class="st">'n'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Sorting states and enforcing that order - like making a factor in R</span></span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a>state_list <span class="op">=</span> college_names.State.unique().tolist()</span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a>college_names.State <span class="op">=</span> pd.Categorical(college_names.State, categories <span class="op">=</span> state_list)</span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span> <span class="co"># graphs and charts</span></span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a><span class="co"># By state - percentage of institution names</span></span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a>ggplot(data <span class="op">=</span> college_names) <span class="op">+</span> <span class="op">\</span></span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a>geom_text(aes(x <span class="op">=</span> <span class="st">"State"</span>, y <span class="op">=</span> <span class="dv">1</span>, label <span class="op">=</span> <span class="st">'label'</span>), ha<span class="op">=</span><span class="st">'right'</span>) <span class="op">+</span> <span class="op">\</span></span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a>geom_col(aes(x <span class="op">=</span> <span class="st">"State"</span>, y <span class="op">=</span> <span class="st">"pct_uses_st_name"</span>)) <span class="op">+</span> coord_flip()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>&lt;ggplot: (8774269801725)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="08-data-cleaning_files/figure-html/string-ops-py-1.png" class="img-fluid" width="4"></p>
</div>
</div>
</details>
</div>
<p>I’m not going to get into regular expressions in this class, but if you do want more power to understand how to work with strings, that’s an excellent skill to pick up.</p>
</section>
<section id="joining-and-splitting-variables" class="level3" data-number="8.3.2">
<h3 data-number="8.3.2" class="anchored" data-anchor-id="joining-and-splitting-variables"><span class="header-section-number">8.3.2</span> Joining and Splitting Variables</h3>
<p>There’s another string-related task that is fairly commonly encountered: separating variables into two different columns (as in Table 3 in the previous chapter).</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center" width="50%">
<figure class="figure">
<p><img src="images/tidyr_separate.png" class="img-fluid figure-img" style="width:50.0%"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">A visual representation of what separating variables means for data set operations.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<details>
<summary>
Separating Variables in R
</summary>
<p>We can use <code>str_extract()</code> if we want, but it’s actually faster to use <code>separate()</code>, which is part of the <code>tidyr</code> package. There is also <code>extract()</code>, which is another <code>tidyr</code> function that uses regular expressions and capture groups to split variables up.</p>
<div class="cell">
<div class="sourceCode" id="cb63"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>table3 <span class="sc">%&gt;%</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> rate, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"cases"</span>, <span class="st">"population"</span>), <span class="at">sep =</span> <span class="st">"/"</span>, <span class="at">remove =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 6 × 5
  country      year rate              cases  population
  &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;             &lt;chr&gt;  &lt;chr&gt;     
1 Afghanistan  1999 745/19987071      745    19987071  
2 Afghanistan  2000 2666/20595360     2666   20595360  
3 Brazil       1999 37737/172006362   37737  172006362 
4 Brazil       2000 80488/174504898   80488  174504898 
5 China        1999 212258/1272915272 212258 1272915272
6 China        2000 213766/1280428583 213766 1280428583</code></pre>
</div>
</div>
<p>I’ve left the rate column in the original data frame just to make it easy to compare and verify that yes, it worked.</p>
<code>separate()</code> will also take a full on regular expression if you want to capture only parts of a string to put into new columns.
</details>
<details>
<summary>
Separating Variables in python
</summary>
<p>In python, we can do a similar observation, but one convention of python that is very useful here is that we can do a multiple-assign on the left hand side.</p>
<div class="cell">
<div class="sourceCode" id="cb65"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>table3 <span class="op">=</span> r.table3</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>table3[[<span class="st">"cases"</span>, <span class="st">"population"</span>]] <span class="op">=</span> table3[<span class="st">"rate"</span>].<span class="bu">str</span>.split(<span class="st">"/"</span>, expand <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>table3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>       country  year               rate   cases  population
0  Afghanistan  1999       745/19987071     745    19987071
1  Afghanistan  2000      2666/20595360    2666    20595360
2       Brazil  1999    37737/172006362   37737   172006362
3       Brazil  2000    80488/174504898   80488   174504898
4        China  1999  212258/1272915272  212258  1272915272
5        China  2000  213766/1280428583  213766  1280428583</code></pre>
</div>
</div>
<p>We use <code>col.str.split()</code> to split the column, <code>expand = True</code> indicates that we want separate columns, and then by including two things on the left hand side, we can store each column into its own new value.</p>
</details>
<p>And, of course, there is a complementary operation, which is when it’s necessary to join two columns to get a useable data value.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center" width="50%">
<figure class="figure">
<p><img src="images/tidyr_unite.png" class="img-fluid figure-img" style="width:50.0%"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">A visual representation of what uniting variables means for data set operations.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<details>
<summary>
Joining Variables in R
</summary>
<p><code>separate()</code> has a complement, <code>unite()</code>, which is useful for handling situations like in table5:</p>
<div class="cell">
<div class="sourceCode" id="cb67"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>table5 <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="at">col =</span> <span class="st">"year"</span>, century<span class="sc">:</span>year, <span class="at">sep =</span> <span class="st">''</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> rate, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"cases"</span>, <span class="st">"population"</span>), <span class="at">sep =</span> <span class="st">"/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 6 × 4
  country     year  cases  population
  &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;     
1 Afghanistan 1999  745    19987071  
2 Afghanistan 2000  2666   20595360  
3 Brazil      1999  37737  172006362 
4 Brazil      2000  80488  174504898 
5 China       1999  212258 1272915272
6 China       2000  213766 1280428583</code></pre>
</div>
</div>
<p>Note that separate and unite both work with character variables - it’s not necessarily true that you’ll always be working with character formats when you need to do these operations. For instance, it’s relatively common to need to separate dates into year, month, and day as separate columns (or to join them together).</p>
<p>Of course, it’s much easier just to do a similar two-step operation (we have to convert to numeric variables to do math)</p>
<div class="cell">
<div class="sourceCode" id="cb69"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>table5 <span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(century)<span class="sc">*</span><span class="dv">100</span> <span class="sc">+</span> <span class="fu">as.numeric</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>century)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 6 × 3
  country      year rate             
  &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;            
1 Afghanistan  1999 745/19987071     
2 Afghanistan  2000 2666/20595360    
3 Brazil       1999 37737/172006362  
4 Brazil       2000 80488/174504898  
5 China        1999 212258/1272915272
6 China        2000 213766/1280428583</code></pre>
</div>
</div>
<p>(Handy shortcut functions in <code>dplyr</code> don’t completely remove the need to think).</p>
</details>
<details>
<summary>
Joining Variables in python
</summary>
<div class="cell">
<div class="sourceCode" id="cb71"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>r.table5.assign(year <span class="op">=</span> r.table5.century <span class="op">+</span> r.table5.year) <span class="co"># String concatenation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>       country century  year               rate
0  Afghanistan      19  1999       745/19987071
1  Afghanistan      20  2000      2666/20595360
2       Brazil      19  1999    37737/172006362
3       Brazil      20  2000    80488/174504898
4        China      19  1999  212258/1272915272
5        China      20  2000  213766/1280428583</code></pre>
</div>
</div>
<p>In python, we can join character values using <code>+</code>, so it’s an even simpler process. Of course, as in R, it may be better to do a two-step operation to convert to numeric variables. Unlike in R, you can do the string concatenation process first and then convert to numeric variables without having to think too much.</p>
<div class="cell">
<div class="sourceCode" id="cb73"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="op">=</span> r.table5.assign(year <span class="op">=</span> r.table5.century <span class="op">+</span> r.table5.year)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>tmp.<span class="op">\</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>assign(year <span class="op">=</span> tmp.year.astype(<span class="bu">int</span>)).<span class="op">\</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>drop(<span class="st">"century"</span>, axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>       country  year               rate
0  Afghanistan  1999       745/19987071
1  Afghanistan  2000      2666/20595360
2       Brazil  1999    37737/172006362
3       Brazil  2000    80488/174504898
4        China  1999  212258/1272915272
5        China  2000  213766/1280428583</code></pre>
</div>
</div>
</details>
</section>
<section id="additional-string-manipulation-information" class="level3 unnumbered learn-more">
<h3 class="unnumbered learn-more anchored" data-anchor-id="additional-string-manipulation-information">Additional String Manipulation Information</h3>
<p>String manipulation</p>
<ul>
<li><a href="https://r4ds.had.co.nz/strings.html">R4DS chapter - strings</a></li>
<li><a href="https://regex101.com/">PCRE tester</a></li>
<li><a href="https://spannbaueradam.shinyapps.io/r_regex_tester/">R regex tester</a> - has a short timeout period and will disconnect you if you’re idle too long. But you can also clone the repo <a href="https://github.com/AdamSpannbauer/r_regex_tester_app">here</a> and run it locally.</li>
</ul>


</section>
</section>
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    window.tippy(el, {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    }); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</main>
<div class="page-navigation ">
  <div class="nav-page nav-page-previous">
      <a href="./07-data-transformations.html">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Transformations</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./09-functions.html">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Functions</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</div>
</div> <!-- /main column -->
</div> <!-- /row -->
</div> <!-- /container fluid -->


</body></html>